[workspace]
name = "doxyYoda"
version = "0.1.2"
description = "A modern Doxygen theme — CSS Grid, Solarized, dark mode, foldable code"
authors = ["Rohit Goswami <rog32@hi.is>"]
license = "Apache-2.0"
channels = ["conda-forge"]
platforms = ["linux-64", "osx-arm64", "osx-64"]

[dependencies]
doxygen = ">=1.12"
dart-sass = ">=1.50"
graphviz = ">=2.50"
python = ">=3.11"
tbump = ">=6.9"

[tasks]
# ---------- Build ----------
compile = { cmd = "sass src/styles/scss/main.scss src/styles/doxyYoda.css", description = "Compile SCSS → CSS" }
minify = { cmd = "sass --style=compressed --no-source-map src/styles/scss/main.scss src/styles/doxyYoda.min.css", description = "Compile and minify CSS" }
build = { depends-on = ["compile"], description = "Build everything" }

# ---------- Development ----------
watch = { cmd = "sass --watch src/styles/scss/main.scss:src/styles/doxyYoda.css", description = "Watch SCSS and recompile on change" }

# ---------- Demo ----------
demo = { cmd = "doxygen demo/Doxyfile", depends-on = ["compile"], description = "Build demo documentation site" }
serve = { cmd = "python -m http.server 8000 -d demo/build/html", depends-on = ["demo"], description = "Serve demo site on localhost:8000" }

# ---------- Release ----------
release = { cmd = """
  version=$(cat version.txt) && \
  echo "Building $version" && \
  mkdir -p doxyYoda/css && \
  cp version.txt doxyYoda && \
  cp -r src/html doxyYoda && \
  cp -r src/xml doxyYoda && \
  sass --style=compressed --no-source-map src/styles/scss/main.scss doxyYoda/css/doxyYoda.min.css && \
  echo "Apache 2 licensed Doxygen theme by Rohit Goswami <https://rgoswami.me>.\nSee: https://github.com/HaoZeke/doxyYoda for details" > doxyYoda/README && \
  tar -czf "doxyYoda_$version.tar.gz" doxyYoda && \
  rm -rf doxyYoda && \
  echo "Done: doxyYoda_$version.tar.gz"
""", depends-on = ["compile"], description = "Build release tarball" }

# ---------- Version ----------
bump = { cmd = "tbump --no-push", description = "Bump version (pass version as arg)" }

# ---------- Clean ----------
clean = { cmd = "rm -rf demo/build src/styles/doxyYoda.css src/styles/doxyYoda.css.map src/styles/doxyYoda.min.css", description = "Remove build artifacts" }
